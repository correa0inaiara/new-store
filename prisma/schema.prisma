generator client {
  provider = "prisma-client"
  output   = "../prisma/generated"
}

datasource db {
  provider = "postgresql"
}

model Category {
  name        String        @unique
  title       String
  image       Bytes?
  category_id String        @id @default(uuid())
  product     Product[]
  subcategory Subcategory[]
}

model Subcategory {
  name           String    @unique
  title          String
  image          Bytes?
  category_id    String
  subcategory_id String    @id @default(uuid())
  product        Product[]
  category       Category  @relation(fields: [category_id], references: [category_id])
}

model Product {
  title          String
  price          Decimal
  description    String
  image          Bytes?
  category_id    String
  product_id     String       @id @default(uuid())
  stock          Int          @default(0)
  subcategory_id String
  cart_item      Cart_Item[]
  order_item     Order_Item[]
  category       Category     @relation(fields: [category_id], references: [category_id])
  subcategory    Subcategory  @relation(fields: [subcategory_id], references: [subcategory_id])
}

model Address {
  address_id    String       @id @default(uuid())
  type          ADDRESS_TYPE @default(MAIN)
  address_1     String
  address_2     String
  street_number Int
  city          String
  state         String
  country       String
  zip_code      String
  user_id       String
  user          User         @relation(fields: [user_id], references: [user_id])
}

model User {
  user_id    String    @id @default(uuid())
  email      String
  created_at DateTime  @default(now())
  role       USER_ROLE @default(CUSTOMER)
  address    Address[]
  cart       Cart[]
  order      Order[]
}

model Cart {
  cart_id          String      @id @default(uuid())
  user_id          String
  session_id       String
  created_at       DateTime    @default(now())
  last_activity_at DateTime    @default(now())
  status           CART_STATUS @default(ACTIVE)
  user             User        @relation(fields: [user_id], references: [user_id])
  cart_item        Cart_Item[]
  order            Order?
}

model Cart_Item {
  cart_item_id String  @id @default(uuid())
  cart_id      String
  product_id   String
  quantity     Int
  cart         Cart    @relation(fields: [cart_id], references: [cart_id])
  product      Product @relation(fields: [product_id], references: [product_id])
}

model Order {
  order_id   String       @id @default(uuid())
  user_id    String
  status     ORDER_STATUS @default(PENDING_PAYMENT)
  cart_id    String       @unique
  cart       Cart         @relation(fields: [cart_id], references: [cart_id])
  user       User         @relation(fields: [user_id], references: [user_id])
  order_item Order_Item[]
}

model Order_Item {
  order_item_id String  @id @default(uuid())
  order_id      String
  product_id    String
  order         Order   @relation(fields: [order_id], references: [order_id])
  product       Product @relation(fields: [product_id], references: [product_id])
}

enum USER_ROLE {
  ADMIN
  SELLER
  CUSTOMER
}

enum ADDRESS_TYPE {
  MAIN
  ALTERNATIVE
}

enum CART_STATUS {
  ACTIVE
  ABANDONED
  CHECKOUT_PENDING
  COMPLETED
}

enum ORDER_STATUS {
  PENDING_PAYMENT
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}
